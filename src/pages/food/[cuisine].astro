---
import Base from "../../layouts/Base.astro";
import cuisines from "../../data/cuisines.json";
import restaurants from "../../data/restaurants.json";
import RestaurantCard from "../../components/RestaurantCard.astro";

export function getStaticPaths() {
  return cuisines.map((c) => ({
    params: { cuisine: c.key },
  }));
}

const { cuisine } = Astro.params;

// cuisines.json is like: [{ key, name, emoji }]
const cuisineObj =
  cuisines.find((c) => c.key === cuisine) ||
  cuisines.find((c) => String(c.name).toLowerCase() === String(cuisine).toLowerCase());

const targetKey = cuisineObj?.key ?? cuisine ?? "";
const targetName = cuisineObj?.name ?? cuisine ?? "";
const emoji = cuisineObj?.emoji ?? "ðŸ½ï¸";

function norm(v) {
  return String(v ?? "").trim().toLowerCase();
}

function hasCuisine(r) {
  const list = Array.isArray(r?.cuisines) ? r.cuisines : [];
  const keyN = norm(targetKey);
  const nameN = norm(targetName);

  return list.some((c) => {
    const cN = norm(c);
    return cN === keyN || cN === nameN;
  });
}

const picks = (Array.isArray(restaurants) ? restaurants : []).filter(hasCuisine);
---
<Base
  title={`${emoji} ${targetName} â€” Fenwick Island Social`}
  description={`Curated ${targetName} picks around Fenwick Island, Bethany Beach, and Ocean City.`}
>
  <section class="section">
    <div class="kicker">Food</div>
    <h1 class="h1">{emoji} {targetName}</h1>

    {picks.length ? (
      <div class="grid">
        {picks.map((r) => (
          <RestaurantCard restaurant={r} />
        ))}
      </div>
    ) : (
      <div class="card" style="padding:16px; margin-top:12px;">
        <div class="h2" style="margin:0 0 6px 0;">No picks yet</div>
        <p class="p" style="margin:0; opacity:.9;">
          Weâ€™ll add more {targetName.toLowerCase()} spots soon.
        </p>
      </div>
    )}
  </section>

  <style>
    .grid{
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap:14px;
      margin-top:14px;
    }
    @media (max-width: 900px){ .grid{ grid-template-columns: repeat(2, minmax(0, 1fr)); } }
    @media (max-width: 560px){ .grid{ grid-template-columns: 1fr; } }
  </style>
</Base>
